<div class="max-content">
  <!-- TODO where is this used -> needs translation if used-->
  <mat-card>
    @let data = orderData$ | async;
    @let isAuthenticated = isAuthenticated$ | async;
    <div *ngIf="!isAuthenticated">
        <mat-card-header>
        <mat-card-title i18n>GeoShop - Validation</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        Not authenticated
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="primary" routerLink="/" i18n>OK</button>
      </mat-card-actions>
    </div>
    <div *ngIf="isAuthenticated && (!data || !data.item || !data.order)">
      <mat-card-header>
        <mat-card-title i18n>GeoShop - Validation</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (!data) {
        <mat-spinner class="flex" diameter="48" color="accent" style="margin-right: 10px">
        </mat-spinner>
        } @else if(!data.item) {
        <p i18n>No order item with token "{{token$ | async}}"</p>
        } @else if(!data.order) {
        @let item = data.item;
        <p i18n>
          No order with id {{item.order_guid}} found for item "{{item.id}}: {{item.product.label}}"
        </p>
        }
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="primary" routerLink="/" i18n>OK</button>
      </mat-card-actions>
    </div>
    <div *ngIf="isAuthenticated && data && data.order && data.item">
      @let order = data.order;
      @let item = data.item;
      <mat-card-header>
        <mat-card-title i18n>{{item.product.id}}. {{item.product.label}} - à valider</mat-card-title>
        <mat-card-subtitle i18n>
          Cette page permet d'autoriser ou d'annuler l'utilisation d'un produit commandé sur le geoshop.
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <h4 i18n>Titre du mandat {{order.order_type | lowercase}}:</h4>
        <p>{{order.title}}</p>
        <h4 i18n>Description fournie par le client:</h4>
        <p>{{order.description}}</p>
        <h4 i18n>Détails du client:</h4>
        <p>
          <span *ngIf="order.client.company_name">{{order.client.company_name}}<br></span>
          {{order.client.first_name}} {{order.client.last_name}}<br>
          {{order.client.street}}<br>
          <span *ngIf="order.client.street2">{{order.client.street2}}<br></span>
          {{order.client.postcode}} {{order.client.city}}<br>
          <span *ngIf="order.client.phone">{{ order.client.phone }}<br></span>
          <a href="mailto:{{ order.client.email }}">{{ order.client.email }}</a>
        </p>
        <div class="mini-map" [id]="'mini-map-' + order.id"></div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="primary" (click)="proceedOrder(true)" i18n>ACCEPTER</button>
        <button mat-button color="warn" (click)="proceedOrder(false)" i18n>REFUSER</button>
      </mat-card-actions>
    </div>
  </mat-card>

</div>
